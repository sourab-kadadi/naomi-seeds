<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/app/orders"></ion-back-button>
    </ion-buttons>
    <!-- <ion-menu-button slot="start"></ion-menu-button> -->
    <ion-title class="ion-text-center">Order Details</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <ngx-ui-loader [loaderId]="'loader-detail-order-page-new'"></ngx-ui-loader>

  <div *ngIf="isLoading" class="ion-padding-top">
    <ion-card>
      <ion-item>
        <ion-col size="3" size-md="6">
          <ion-card-header class="ion-padding">
            <ion-label>
              <h3>
                <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
              </h3>
              <p>
                <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
              </p>
              <p>
                <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
              </p>
              <p>
                <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
              </p>
            </ion-label>
          </ion-card-header>
        </ion-col>
        <ion-col size="9" size-md="6" class="card-margin-left">
          <ion-card-header class="ion-padding">
            <ion-label>
              <h3>
                <ion-skeleton-text animated style="width: 90%"></ion-skeleton-text>
              </h3>
              <p>
                <ion-skeleton-text animated style="width: 90%"></ion-skeleton-text>
              </p>
              <p>
                <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
              </p>
              <p>
                <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
              </p>
            </ion-label>
          </ion-card-header>
        </ion-col>
      </ion-item>
    </ion-card>
  </div>

  <ion-refresher slot="fixed" pullFactor="0.9" pullMin="60" pullMax="200" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" pullingText="Pull to refresh"
      refreshingSpinner="circles" refreshingText="Refreshing..." class="ion-padding-top-refresh">
    </ion-refresher-content>
  </ion-refresher>

  <ion-card *ngIf="active" class="padding-top padding-bottom">
    <!-- <ion-item lines="none"> -->
    <!-- <ion-card-header class="header-margin-left"> -->
    <!-- <ion-card-header > -->
    <ion-item lines="none" class="item-margins">
      <ion-col size="3" size-md="6" class="col-margin-right">
        <ion-card-subtitle>
          <b>Txn No.:</b>
        </ion-card-subtitle>
      </ion-col>
      <ion-col size="9" size-md="6" class="col-margin-left">
        <ion-card-subtitle>
          {{ orderDetail?.orderNumber }}
        </ion-card-subtitle>
      </ion-col>
    </ion-item>

    <ion-item lines="none" class="item-margins">
      <ion-col size="3" size-md="6" class="col-margin-right">
        <ion-card-subtitle>
          <b> Order Type: </b>
        </ion-card-subtitle>
      </ion-col>
      <ion-col size="9" size-md="6" class="col-margin-left ion-text-wrap">
        <ion-card-subtitle>
          {{ orderDetail?.orderType }}
        </ion-card-subtitle>
      </ion-col>
    </ion-item>



    <ion-item lines="none" class="item-margins">
      <ion-col size="3" size-md="6" class="col-margin-right">
        <ion-card-subtitle>
          <b> From: </b>
        </ion-card-subtitle>
      </ion-col>
      <ion-col size="9" size-md="6" class="col-margin-left ion-text-wrap">
        <ion-card-subtitle>
          {{ orderDetail?.orderFromProfileName }}
        </ion-card-subtitle>
      </ion-col>
    </ion-item>


    <ion-item lines="none" class="item-margins">
      <ion-col size="3" size-md="6" class="col-margin-right">
        <ion-card-subtitle>
          <b> To: </b>
        </ion-card-subtitle>
      </ion-col>
      <ion-col size="9" size-md="6" class="col-margin-left">
        <ion-card-subtitle>
          {{ orderDetail?.orderToProfileName }}
        </ion-card-subtitle>
      </ion-col>
    </ion-item>


    <ion-item lines="none" class="item-margins">
      <ion-col size="3" size-md="6" class="col-margin-right">
        <ion-card-subtitle>
          <b> Txn Date: </b>
        </ion-card-subtitle>
      </ion-col>
      <ion-col size="9" size-md="6" class="col-margin-left">
        <ion-card-subtitle>
          {{ orderDetail?.orderDate | date }}
        </ion-card-subtitle>
      </ion-col>
    </ion-item>
    <!-- </ion-card-header> -->

    <!-- </ion-item> -->
  </ion-card>

  <!-- skeleton text -->
  <ion-card *ngIf="isLoading">
    <ion-grid>
      <ion-row class="ion-row" class="line-divider">
        <ion-col size="6">
          <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
        </ion-col>

        <ion-col size="2">
          <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
        </ion-col>
        <ion-col size="3" class="ion-align-center">
          <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
        </ion-col>
      </ion-row>
      <br />
      <ion-row class="ion-row" *ngFor="let number of [0,1,2,3]" class="line-divider">

        <ion-col size="6">
          <ion-label class="ion-text-wrap">
            <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
          </ion-label>
        </ion-col>

        <ion-col size="2">
          <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
        </ion-col>

        <ion-col size="3">
          <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
        </ion-col>

        <ion-col size="1">
          <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
        </ion-col>

      </ion-row>

      <br />
      <ion-row>
        <ion-col size="5" offset="1">
          <ion-skeleton-text animated style="width: 65%"></ion-skeleton-text>
        </ion-col>
        <ion-col size="2">
          <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
        </ion-col>
        <ion-col size="3">
          <ion-skeleton-text animated style="width: 75%"></ion-skeleton-text>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-card>



  <!-- <ion-card *ngIf="active">
    <ion-card-subtitle class="ion-text-center">
      <h5> <b>Item Details</b> </h5>
    </ion-card-subtitle>
    <ion-grid>
      <ion-row class="ion-row" class="line-divider">
        <ion-col size="5">
          <b>Items</b>
        </ion-col>
        <ion-col size="2" class="ion-align-center-amount">
          <td>
            <b>      Qty </b></td>
      <td>      Kgs</td>
        </ion-col>
        <ion-col size="4" class="ion-align-center-amount">
          <td>
          <b>      Amount </b></td>
    <td>      &#8377;</td>
        </ion-col>
        <ion-col size="1"></ion-col>
      </ion-row>
      <br />
      <ion-row class="ion-row" *ngFor="let item of items; let i = index" class="line-divider">

        <ion-col size="5">
          <ion-label class="ion-text-wrap">
            <b> {{item?.productName}}</b><br>
             {{item?.crop}}
            <br> &#8377;{{item?.rate}}/Kg
            <br> Lot - {{item?.lotNumber}}
          </ion-label>
        </ion-col>

        <ion-col size="2" class="ion-item-center-content"> {{item?.quantity.toLocaleString("en-IN")}} </ion-col>

        <ion-col size="4" class="ion-item-center-content"> {{(item?.amount).toLocaleString("en-IN")}} </ion-col>

        <ion-col size="1" class="ion-item-center-content">


        </ion-col>
      </ion-row>

      <br />
      <ion-row>
        <ion-col size="5" >
          <b>Total</b>
        </ion-col>
        <ion-col size="2" class="ion-item-center-content"> {{orderDetail?.totalQuantity.toLocaleString("en-IN")}} </ion-col>

        <ion-col size="4" class="ion-item-center-content">
          &#8377; {{orderDetail?.totalValue.toLocaleString("en-IN")}}
        </ion-col>
<ion-col size="1"></ion-col>
      </ion-row>
    </ion-grid>
  </ion-card> -->










  <!-- <div *ngIf="items?.length > 0">
     -->
  <div *ngIf="active">


    <ion-card *ngIf=" orderTypeSelection === 'IPT' || orderTypeSelection=== 'SALES_RETURN'">
      <ion-card-header class="card-header-align-centre">Return</ion-card-header>
      <div>
        <ion-grid>
          <ion-row class="ion-row">
            <ion-col size="5" class="display_flex_center">
              <b>Items</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <td>
                <b> Qty </b>
              </td>
              <td> (kgs & pkts)</td>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <td>
                <b> Amount </b>
              </td>
              <td> &#8377;</td>
            </ion-col>
          </ion-row>
          <ion-row class="ion-row" *ngFor="let item of items; let i = index">
            <ion-col size="5">
              <ion-label class="ion-text-wrap">
                <b> {{item?.productName}}</b><br>
                <b> {{item?.crop}}</b>
                <br>
                <b> (Lot - {{item?.lotNumber}})</b>
                <br>
                &#8377;{{item?.effectiveRatePerKgForReturn?.toLocaleString("en-IN")}}/ Kg<br>
                &#8377;{{item?.packetInvoicePriceForReturn?.toLocaleString("en-IN")}}/ Packet
              </ion-label>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              {{item?.itemQuantityInKgs?.toLocaleString("en-IN")}} kgs <br>
              {{item?.numberOfPacketsOrdered?.toLocaleString("en-IN")}} pkts
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <!-- <ion-text slot="end" color="dark" class="price ion-text-right"> -->
              <!-- {{(item?.itemAmountForReturn).toLocaleString("en-IN")}} -->
              {{item?.itemAmountForReturn}}
              <!-- </ion-text> -->
            </ion-col>
            <ion-col size="1" class="ion-align-center-amount">
              <ion-button size="small" color="danger" fill="clear" [routerLink]="['./', item._id]">
                <ion-icon name="open-outline"></ion-icon>
              </ion-button>

            </ion-col>
            <!-- </ion-item> -->
          </ion-row>
          <ion-row>
            <ion-col size="5" class="display_flex_center">
              <b>Total</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <b> {{orderDetail?.totalQuantity?.toLocaleString("en-IN")}} kgs</b>
              <b> {{orderDetail?.totalUnits?.toLocaleString("en-IN")}} pkts</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <b> &#8377; {{orderDetail?.totalValueReturn?.toLocaleString("en-IN")}}</b>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-card>




    <ion-card *ngIf="orderTypeSelection=== 'IPT' || orderTypeSelection=== 'COMPANY_SALE'">
      <ion-card-header class="card-header-align-centre">Sale</ion-card-header>
      <div>
        <ion-grid>
          <ion-row class="ion-row">
            <ion-col size="5" class="display_flex_center">
              <b>Items</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <td>
                <b> Qty </b>
              </td>
              <td> (kgs & pkts)</td>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <td>
                <b> Amount </b>
              </td>
              <td> &#8377;</td>
            </ion-col>
          </ion-row>
          <ion-row class="ion-row" *ngFor="let item of items; let i = index">
            <ion-col size="5">
              <ion-label class="ion-text-wrap">
                <b> {{item?.productName}}</b><br>
                <b> {{item?.crop}}</b>
                <br>
                <b> (Lot - {{item?.lotNumber}})</b>
                <br>
                &#8377;{{item?.effectiveRatePerKgForSale?.toLocaleString("en-IN")}}/ Kg<br>
                &#8377;{{item?.packetInvoicePriceForSale?.toLocaleString("en-IN")}}/ Packet
              </ion-label>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              {{item?.itemQuantityInKgs?.toLocaleString("en-IN")}} kgs <br>
              {{item?.numberOfPacketsOrdered?.toLocaleString("en-IN")}} pkts
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <!-- <ion-text slot="end" color="dark" class="price ion-text-right"> -->
              {{item?.itemAmountForSale.toLocaleString("en-IN")}}
              <!-- </ion-text> -->
            </ion-col>
            <ion-col size="1" class="ion-align-center-amount">
              <ion-button size="small" color="danger" fill="clear" [routerLink]="['./', item._id]">
                <ion-icon name="open-outline"></ion-icon>
              </ion-button>

            </ion-col>
            <!-- </ion-item> -->
          </ion-row>
          <ion-row>
            <ion-col size="5" class="display_flex_center">
              <b>Total</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <b> {{orderDetail?.totalQuantity?.toLocaleString("en-IN")}} kgs</b>
              <b> {{orderDetail?.totalUnits?.toLocaleString("en-IN")}} pkts</b>
            </ion-col>
            <ion-col size="3" class="ion-align-center-amount">
              <b> &#8377; {{orderDetail?.totalValueSale?.toLocaleString("en-IN")}}</b>
              <!-- <b> &#8377; {{modelForm?.totalValueSale.value}}</b> -->
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-card>
  </div>

  <ion-card *ngIf="isLoading">
    <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
  </ion-card>
  <ion-card *ngIf="active">
    <ion-accordion-group>
      <ion-accordion value="colors">
        <ion-item slot="header">
          <ion-card-subtitle class="ion-text-center">
            <h5> <b>Transport Details</b> </h5>
          </ion-card-subtitle>
        </ion-item>

        <ion-list slot="content" lines="none">
          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> RR LR Number:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle> {{orderDetail?.rrOrLrNum}}</ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Transport:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                {{ orderDetail?.transport }}</ion-card-subtitle>
            </ion-col>
          </ion-item>



          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Vehicle Number:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                {{ orderDetail?.vehicleNo }}</ion-card-subtitle>
            </ion-col>
          </ion-item>


          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Freight Total:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                &#8377; {{ orderDetail?.freightTotal.toLocaleString("en-IN") }}
              </ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Freight Paid:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                &#8377; {{ orderDetail?.frightPaidAdvance.toLocaleString("en-IN")}}</ion-card-subtitle>
            </ion-col>
          </ion-item>


          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Freight Pending Amt:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                &#8377; {{ orderDetail?.frightToPay.toLocaleString("en-IN") }}</ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item class="item-height">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Driver Name:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6" *ngIf="orderDetail.driverName">
              <ion-card-subtitle>
                {{ orderDetail?.driverName}}</ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item class="item-height" *ngIf="orderDetail.driverContact">
            <ion-col size="5" md="6">
              <ion-card-subtitle><b> Driver Mobile:</b></ion-card-subtitle>
            </ion-col>

            <ion-col size="7" md="6">
              <ion-card-subtitle>
                <a href="tel:{{ orderDetail?.driverContact }}" style="text-decoration: none;">
                  <ion-icon name="call"></ion-icon>
                  {{ orderDetail?.driverContact }}
                  <ion-icon class="zmdi zmdi-phone ion-text-end icon-padding"></ion-icon>
                </a>
              </ion-card-subtitle>
            </ion-col>
          </ion-item>
        </ion-list>
      </ion-accordion>
    </ion-accordion-group>
  </ion-card>

  <ion-card *ngIf="isLoading">
    <ion-skeleton-text animated style="width: 45%"></ion-skeleton-text>
  </ion-card>

  <ion-card *ngIf="active">
    <ion-accordion-group>
      <ion-accordion value="colors">
        <ion-item slot="header" class="ion-item-margin">
          <ion-card-subtitle class="ion-text-center">
            <h5><b>Work-Flow Status</b> </h5>
          </ion-card-subtitle>
        </ion-item>

        <ion-list slot="content" lines="none" class="ion-item-margin">


          <ion-item>
            <ion-col size="7" md="6">
              <ion-card-subtitle><b> Approval from <br> {{orderDetail?.orderFromProfileName}} </b></ion-card-subtitle>
            </ion-col>

            <ion-col size="5" md="6">
              <ion-card-subtitle> {{orderDetail?.fromProfileApproval}}</ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item>
            <ion-col size="7" md="6">
              <ion-card-subtitle><b> Manager's Approval <br>for Delivery Challan: </b></ion-card-subtitle>
            </ion-col>

            <ion-col size="5" md="6">
              <ion-card-subtitle> {{orderDetail?.managerApprovalGenerateDC}}</ion-card-subtitle>
            </ion-col>
          </ion-item>

          <ion-item>
            <ion-col size="7" md="6">
              <ion-card-subtitle><b> Sales Officer <br> Update on Shipment of Goods

                </b></ion-card-subtitle>
            </ion-col>

            <ion-col size="5" md="6">
              <ion-card-subtitle> {{orderDetail?.salesOfficerApprovalStatus}}</ion-card-subtitle>
            </ion-col>
          </ion-item>


          <ion-item>
            <ion-col size="7" md="6">
              <ion-card-subtitle><b> Status from Receipent <br> {{orderDetail?.orderToProfileName}}

                </b></ion-card-subtitle>
            </ion-col>

            <ion-col size="5" md="6">
              <ion-card-subtitle> {{orderDetail?.toProfileConfirmation}}</ion-card-subtitle>
            </ion-col>
          </ion-item>


          <ion-item>
            <ion-col size="7" md="6">
              <ion-card-subtitle><b> Manager's Final Approval <br> to Complete Txn: </b></ion-card-subtitle>
            </ion-col>
            <ion-col size="5" md="6">
              <ion-card-subtitle> {{orderDetail?.managerFinalApproval}}</ion-card-subtitle>
            </ion-col>
          </ion-item>
          <ion-item lines="none">

            <ion-col size="3">
              <ion-card-subtitle class="item-margin-left"><b>DC</b> </ion-card-subtitle>
            </ion-col>
            <ion-col size="2">
              <ion-icon name="checkmark-circle-outline" color="success"
                *ngIf="orderDetail?.managerApprovalGenerateDC === 'APPROVED'"></ion-icon>
              <ion-icon name="close-circle-outline" color="danger"
                *ngIf="orderDetail?.managerApprovalGenerateDC === 'PENDING'"></ion-icon>
            </ion-col>
            <ion-col size="4">
              <ion-card-subtitle><b>Invoice &<br> Credit Note</b> </ion-card-subtitle>
            </ion-col>
            <ion-col size="3">
              <ion-icon name="checkmark-circle-outline" color="success"
                *ngIf="orderDetail?.managerFinalApproval === 'APPROVED'"></ion-icon>
              <ion-icon name="close-circle-outline" color="danger"
                *ngIf="orderDetail?.managerFinalApproval === 'PENDING'"></ion-icon>
            </ion-col>
          </ion-item>
        </ion-list>
      </ion-accordion>
    </ion-accordion-group>


    <!-- <ion-card-subtitle
        ><b>DC created at: </b> {{ orderDetail?.createdAt }}</ion-card-subtitle
      >
      <ion-card-subtitle
        ><b>DC updated at: </b> {{ orderDetail?.updatedAt }}</ion-card-subtitle
      > -->

  </ion-card>





  <!-- 1st stage approval profile -->

  <ion-card
    *ngIf="(active && orderDetail?.fromProfileApproval === 'PENDING') && (userRole ==='ADMIN' || (userRole==='DISTRIBUTOR' && userLinkToProfileId === orderDetail?.orderFromProfileId._id )) ">
    <ion-card-subtitle class="ion-text-center">
      <h5> <b>Update Approval</b> </h5>
    </ion-card-subtitle>
    <ion-row class="margin-left">
      <ion-card-subtitle>
        Please confirm to send the goods
      </ion-card-subtitle>
    </ion-row>
    <br>
    <ion-row class="display-flex-arrange">
      <ion-col *ngIf="userRole ==='ADMIN'" size="5" size-md="3">
        <ion-button color="Danger" (click)="onRejectByFromProfile()" color="danger">
          <ion-icon name="close-outline"></ion-icon>
          Reject
        </ion-button>
      </ion-col>
      <ion-col size="5" size-md="3">
        <ion-button color="primary" (click)="onApproveByFromProfile()">
          <ion-icon name="checkmark-done-outline"></ion-icon>
          Approve
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-card>


  <!-- 2nd stage approval manager for DC-->

  <ion-card *ngIf="active && 
    orderDetail?.fromProfileApproval === 'APPROVED' && 
    (orderDetail?.managerApprovalGenerateDC === 'PENDING' && (userRole==='ADMIN' || userRole==='MANAGER'))">
    <ion-card-subtitle class="ion-text-center">
      <h5> <b>Update Approval</b> </h5>
    </ion-card-subtitle>
    <ion-row class="margin-left">
      <ion-card-subtitle>
        Please confirm to generate Delivery Challan
      </ion-card-subtitle>
    </ion-row>
    <br>
    <ion-row class="display-flex-arrange">
      <ion-col size="5" size-md="3">
        <ion-button color="Danger" (click)="onRejectForDC()" color="danger">
          <ion-icon name="close-outline"></ion-icon>
          Reject
        </ion-button>
      </ion-col>
      <ion-col size="5" size-md="3">
        <ion-button color="primary" (click)="onApproveGenerateDC()">
          <ion-icon name="checkmark-done-outline"></ion-icon>
          Approve
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-card>



  <!-- 3nd stage approval sales officer confirming out for delivery for DC-->
  <!-- <div *ngIf="orderDetail?.fromDistributorApproval === 'APPROVED' &&
orderDetail?.managerApprovalGenerateDC === 'APPROVED' &&
orderDetail?.salesOfficerApprovalStatus === 'PENDING'">
    <ion-card *ngIf="active">
      <ion-card-subtitle class="ion-text-center">
        <h5> <b>Update Approval</b> </h5>
      </ion-card-subtitle>
      <ion-card-header>
        <ion-row class="ion-text-center">
          <ion-col>
            <ion-card-subtitle>
              Please update if the order has been shipped
            </ion-card-subtitle>
          </ion-col>
          <ion-col>
          <ion-button color="primary" (click)="onApproveBySalesOfficerShipping()">
          Yes
          <ion-icon name="checkmark-done-outline"></ion-icon>
          </ion-button>
          <ion-button color="danger">
                        Reject
                    </ion-button>
          </ion-col>
        </ion-row>
      </ion-card-header>
    </ion-card>
  </div> -->

  <!-- 4th stage confirmation from To Profile -->

  <ion-card *ngIf="active && 
    (orderDetail?.fromProfileApproval === 'APPROVED' &&
    orderDetail?.managerApprovalGenerateDC === 'APPROVED' &&
    orderDetail?.toProfileConfirmation === 'PENDING') && 
    (userRole ==='ADMIN' 
    || (userRole==='DISTRIBUTOR' && userLinkToProfileId === orderDetail?.orderToProfileId._id )
    )">
    <ion-card-subtitle class="ion-text-center">
      <h5> <b>Update Receipt</b> </h5>
    </ion-card-subtitle>
    <ion-row class="margin-left">
      <ion-card-subtitle>
        Please Confirm receipt of goods
        
      </ion-card-subtitle>
    </ion-row>
    <br>
    <ion-row class="display-flex-arrange">
      <ion-col *ngIf="userRole ==='ADMIN'" size="5" size-md="3">
        <ion-button color="Danger" (click)="onRejectByToProfile()" color="danger">
          <ion-icon name="close-outline"></ion-icon>
          Reject
        </ion-button>
      </ion-col>
      <ion-col size="5" size-md="3">
        <ion-button color="primary" (click)="onApproveByToProfile()">
          <ion-icon name="checkmark-done-outline"></ion-icon>
          Approve
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-card>



  <!-- 5th stage confirmation by manager for generation of invoice and credit note -->
  <ion-card *ngIf="active && 
    orderDetail?.fromProfileApproval === 'APPROVED' &&
    orderDetail?.managerApprovalGenerateDC === 'APPROVED' &&
    orderDetail?.toProfileConfirmation === 'RECEIVED' && 
    orderDetail?.managerFinalApproval === 'PENDING' && 
    (userRole ==='ADMIN' || userRole==='MANAGER')  ">
    <ion-card-subtitle class="ion-text-center">
      <h5> <b>Update Approval</b> </h5>
    </ion-card-subtitle>
      <ion-row class="margin-left">
        <ion-card-subtitle *ngIf="orderDetail?.orderType ==='COMPANY_SALE'">
          Approve the Transaction and generate Invoice?
        </ion-card-subtitle>
        <ion-card-subtitle *ngIf="orderDetail?.orderType ==='IPT'">
          Approve the Transaction and generate Invoice and Credit Note?
        </ion-card-subtitle>
      </ion-row>
      <ion-row class="display-flex-arrange">
        <ion-col size="5" size-md="3">
          <ion-button color="Danger" (click)="onRejectFinalTxn()" color="danger">
            <ion-icon name="close-outline"></ion-icon>
            Reject
          </ion-button>
        </ion-col>
        <ion-col size="5" size-md="3">
          <ion-button color="primary" (click)="onApproveFinalTxn()">
            <ion-icon name="checkmark-done-outline"></ion-icon>
            Approve
          </ion-button>
        </ion-col>
      </ion-row>
  </ion-card>

</ion-content>
<ion-footer>
  <ion-grid>
   <ion-row class="pdf-buttons" *ngIf="active">
      <div *ngIf="orderDetail?.dcPdfFileName"> <a href="{{ s3path + orderDetail?.dcPdfFileName }}"
          target="_blank"><ion-button color="primary"> <ion-icon name="download"></ion-icon>DC</ion-button></a></div>
      <div *ngIf="orderDetail?.invoicePdfFileName"> <a href="{{ s3path + orderDetail?.invoicePdfFileName }}"
          target="_blank"><ion-button color="primary"> <ion-icon name="download"></ion-icon>Invoice</ion-button></a>
      </div>
      <div *ngIf="orderDetail?.creditNotePdfFileName"> <a href="{{ s3path + orderDetail?.creditNotePdfFileName }}"
          target="_blank"><ion-button color="primary"> <ion-icon name="download"></ion-icon>Credit Note</ion-button></a>
      </div>
    </ion-row>
  </ion-grid>
</ion-footer>